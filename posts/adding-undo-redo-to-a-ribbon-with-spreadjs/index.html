<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Adding Undo/Redo to a Ribbon with SpreadJS</title>
    <meta name="description" content="Spread Studio is our new cross-platform toolkit that includes components for Windows Forms, ASP.NET, WPF, WinRT, and Silverlight all in one package. This new package includes the new releases of Spread for WinForms and Spread for ASP.NET." name="description" />
    <meta name="keywords" content="Spread.NET, ASP.NET, WPF, Silverlight, WinRT, .NET, spreadsheets, Data, PDF, Spreadsheet, Grid, Excel, analysis, GrapeCity, ASP.NET Spreadsheet component, .NET Spreadsheet component">

    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-194x194.png" sizes="194x194">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <meta name="DC.title" content="GrapeCity Spread" />
    <meta name="geo.region" content="US-NC" />
    <meta name="geo.placename" content="Raleigh" />
    <meta name="geo.position" content="40.458677;-79.924935" />
    <meta name="ICBM" content="40.458677, -79.924935" />

    <!-- Schema.org markup for Google+ -->
    <meta itemprop="name" content="GrapeCity Spread">
    <meta itemprop="description" content="Spreadsheet Components for .NET and JavaScript-HTML5">
    <meta itemprop="image" content="http://spread.grapecity.com/img/spread-photo.png">
    <link href="https://plus.google.com/103999002053720301182/" rel="publisher" />

    <!-- Twitter Card data -->
    <meta name="twitter:card" content="GrapeCity Spread">
    <meta name="twitter:site" content="@gcspread">
    <meta name="twitter:title" content="Spreadsheet Components for .NET and JavaScript-HTML5">
    <meta name="twitter:description" content="Spreadsheet Components for .NET and JavaScript-HTML5">
    <meta name="twitter:creator" content="@gcspread">
    <meta name="twitter:image" content="http://spread.grapecity.com/img/spread-photo.png">

    <!-- Open Graph data -->
    <meta property="og:title" content="GrapeCity Spread" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="http://spread.grapecity.com/" />
    <meta property="og:image" content="http://spread.grapecity.com/img/spread-photo.png" />
    <meta property="og:description" content="Spreadsheet Components for .NET and JavaScript-HTML5" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/style.css?v=1" />

</head>

<body class=" page-Adding Undo/Redo to a Ribbon with SpreadJS">
    <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->




    <main class="body-section">
        <article class="body-inner">    <div class="nav-bar">
        <div class="nav-bar-inner">
            <div class="wrapper">
                <div class="padder clearfix">
                    <div class="search-container clearfix">
                        <input placeholder="Search" type="search" />
                        <a class="search-trigger" href="#"><span class="lnr lnr-magnifier"></span></a>
                    </div>
                    <div class="user-container">
                        <a class="user-trigger" href="#"><span class="lnr lnr-user"></span> <span class="menu-text">Account</span></a>
                        <ul class="user-list hidden">
                            <li><a href="#"><span class="lnr lnr-exit-up"></span> Sign Out</a></li>
                            <li><a href="#"><span class="lnr lnr-license"></span> Licenses</a></li>
                            <li><a href="#"><span class="lnr lnr-bug"></span> Submit An Issue</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>


<aside class="brand-section">
        <div class="brand-inner clearfix">
            <div class="brand-main">
                <div class="brand-logo">
                    <div class="padder clearfix">
                        <h2><a href="/"><img src="/img/sp-icon-white.svg" alt="Spread" /><span class="logo-text">Spread</span> </a></h2>
                    </div>
                </div>
            </div>
            <nav class="nav-main">
                <div class="nav-section">
                    <div class="padder clearfix">
                        <ul class="clearfix">
                            <li class="studio">
                                <a href="/products/spread-studio/"><img src="/img/sp-icon.svg" /><span class="menu-text">Spread Studio</span></a>
                            </li>
                            <li class="js">
                                <a href="/products/spreadjs/"><img src="/img/js-icon.svg" /><span class="menu-text">SpreadJS</span></a>
                            </li>
                            <li class="com">
                                <a href="/products/spread-com/"><img src="/img/com-icon.svg" /><span class="menu-text">Spread COM</span></a>
                            </li>
                            <li><a href="/pages/downloads/"><span class="lnr lnr-download"></span><span class="menu-text">Downloads</span></a></li>
                            <li><a href="/pages/demo-gallery/"><span class="lnr lnr-cog"></span><span class="menu-text">Demo Gallery</span></a></li>
                            <li><a href="/pages/pricing/"><span class="lnr lnr-cart"></span><span class="menu-text">Pricing</span></a></li>
                            <li><a href="/pages/support-community/"><span class="lnr lnr-bubble"></span><span class="menu-text">Support & Community</span></a></li>
                            <li><a href="/pages/documentation/"><span class="lnr lnr-book"></span><span class="menu-text">Documentation</span></a></li>
                        </ul>
                    </div>
                </div>
            </nav>
            <div class="brand-container">
                <div class="padder clearfix">
                    <div class="brand-more">
                        <a class="brand-more-trigger" href="javascript:void(0);"><span class="lnr lnr-menu"></span> <span class="menu-text">More Tools</span></a>
                        <ul class="brand-more-list hidden">
                            <li><a href="#"><span class="lnr lnr-diamond"></span> ActiveReports</a></li>
                            <li><a href="#"><span class="lnr lnr-poop"></span> ComponentOne</a></li>
                            <li><a href="#"><span class="lnr lnr-bug"></span> Wijmo</a></li>
                            <li><a href="#"><span class="lnr lnr-thumbs-down"></span> Xuni</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </aside><header>
    <div class="wrapper">
        <div class="padder clearfix">
            <h1><span class="lnr lnr-book"></span> Adding Undo/Redo to a Ribbon with SpreadJS</h1>
            <h3></h3>
        </div>
</header>


<div class="wrapper-sections">
    <section class="section-page">
        <div class="wrapper">
            <div class="padder clearfix">
                <div class="entry">

                    <p>Utilizing a Ribbon toolbar with SpreadJS is useful and gives control to end-users without needing to have the knowledge of the code behind it. Users might also need to undo or redo an action, which is possible with keyboard shortcuts, but not with buttons in the Ribbon. This tutorial will show how to add undo/redo functionality for a particular button on the ribbon toolbar.</p>
<p>This tutorial is a continuation of: <a title="Adding a Ribbon to SpreadJS" href="http://sphelp.grapecity.com/2015/09/16/adding-a-ribbon-to-spreadjs/" target="_blank">Adding a Ribbon to SpreadJS</a></p>
<p>Download the source code for this tutorial: <a href="http://sphelp.grapecity.com/wp-content/uploads/2015/09/SpreadJS-Ribbon-UndoRedo.zip">SpreadJS Ribbon Undo/Redo</a></p>
<h3 id="choose-a-button-and-create-an-action">Choose a Button and Create an Action</h3>
<p>A simple button to add undo/redo functionality to is the &#8220;Add Row&#8221; button, which simply adds a row to the end of the current sheet.<figure id="attachment_664922" style="width: 513px" class="wp-caption alignnone"></p>
<p><a href="http://sphelp.grapecity.com/wp-content/uploads/2015/09/Figure12.png"><img class="size-full wp-image-664922" alt="The Add Row button on the ribbon bar created in the previous blog." src="http://sphelp.grapecity.com/wp-content/uploads/2015/09/Figure12.png" width="513" height="323" /></a><figcaption class="wp-caption-text">The Add Row button on the ribbon bar created in the previous blog.</figcaption></figure> </p>
<p>To start off, create a new undo/redo action for this particular button by writing a function and defining its prototype:</p>
<pre><code class="”language-javascript”">function AddRowUndoRedoAction(sheet, rowCount) {
    this._oldRowCount = rowCount;
    this._rowCount = rowCount;
    this._sheet = sheet;
}

AddRowUndoRedoAction.prototype = new GcSpread.Sheets.UndoRedo.ActionBase();<pre><code class="hljs"><span class="hljs-type">Adding</span> a row only needs three variables: the original number <span class="hljs-keyword">of</span> rows, the number <span class="hljs-keyword">of</span> rows after adding, <span class="hljs-keyword">and</span> the active sheet. <span class="hljs-type">Other</span> actions could require more variables to keep track <span class="hljs-keyword">of</span>, but <span class="hljs-keyword">for</span> the purposes <span class="hljs-keyword">of</span> this example we will use the simplest action.  
<span class="hljs-type">Next</span>, define the prototype’s “execute” <span class="hljs-keyword">method</span>, which will be called whenever the action <span class="hljs-keyword">is</span> executed. <span class="hljs-type">In</span> this <span class="hljs-keyword">case</span>, adding a row simply increases the number <span class="hljs-keyword">of</span> rows <span class="hljs-keyword">in</span> the active sheet by one:

&lt;pre&gt;&lt;code class=<span class="hljs-string">"”language-javascript”"</span>&gt;<span class="hljs-type">AddRowUndoRedoAction</span>.prototype.execute = function (args) {
    this._sheet.setRowCount(this._rowCount);
}</code></pre>

<p>For the purpose of undoing the action:</p>
<ol>
<li>Define the &#8220;saveState&#8221; method of the action, which saves the state for undoing the action:</li>
</ol>
<pre><code class="”language-javascript”">AddRowUndoRedoAction.prototype.saveState = function () {
    this._oldRowCount = this._sheet.getRowCount();
}<pre><code class="hljs"><span class="hljs-number">2.</span> Define the &amp;#<span class="hljs-number">8220</span>;undo&amp;#<span class="hljs-number">8221</span>; method of the action, which <span class="hljs-keyword">is</span> called when the user presses Ctrl+Z. In <span class="hljs-keyword">this</span> <span class="hljs-keyword">case</span>, the number of rows <span class="hljs-keyword">is</span> decreased by one:

&lt;pre&gt;&lt;code <span class="hljs-keyword">class</span>=<span class="hljs-string">"”language-javascript”"</span>&gt;AddRowUndoRedoAction.prototype.undo = <span class="hljs-built_in">function</span> (args) {
    <span class="hljs-keyword">this</span>._sheet.setRowCount(<span class="hljs-keyword">this</span>._oldRowCount - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}</code></pre>



<h3 id="connect-the-button-to-the-new-action">Connect the Button to the New Action</h3>
<p>Connect this action to the add row button by replacing the original code for the button with the new action:</p>
<p>This code:</p>
<pre><code class="”language-javascript”">$("#ribbon-msofficeButtonAddRow").click(function () {
    activeSheet = spread.getActiveSheet();
    activeSheet.setRowCount(activeSheet.getRowCount() + 1);
});<pre><code class="hljs"><span class="hljs-keyword">is</span> replaced <span class="hljs-keyword">with</span> <span class="hljs-keyword">this</span> code:

&lt;pre&gt;&lt;code <span class="hljs-keyword">class</span>=<span class="hljs-string">"”language-javascript”"</span>&gt;$(<span class="hljs-string">"#ribbon-msofficeButtonAddRow"</span>).click(<span class="hljs-built_in">function</span> () {
    activeSheet = spread.getActiveSheet();
    activeSheet.doCommand(<span class="hljs-keyword">new</span> AddRowUndoRedoAction(activeSheet, activeSheet.getRowCount() + <span class="hljs-number">1</span>));
    spread.focus();
});</code></pre>

<p>When the user clicks the add row button, they can undo it by pressing Ctrl+Z. To add undo/redo functionality for other buttons in the ribbon, create new undo/redo actions for those buttons, similar to this tutorial, and pass them into the doCommand method for the active sheet in each button.click function like the code above.</p>


                </div>
            </div>
        </div>
    </section>
</div>
           <footer>
                <div class="wrapper clearfix">
                    <div class="footer-column footer-half">
                        <div class="padder clearfix">
                            <h3>About Spread Studio</h3>
                            <p>Spread Studio is a multi-functional component that combines the utility of a grid with the power and flexibility of a spreadsheet to help developers working in Microsoft® Visual Studio and JavaScript add Microsoft® Excel functionality to their applications or websites. One package delivers a powerful formula engine, input controls, an API, full data import/export for Excel files, advanced charts, print support, and PDF export. Spread Studio is the only component you need in your toolbox for data bound and unbound WinForms, WPF, WinRT, ASP.NET, and JavaScript applications.</p>
                            <p class="copyright-paragraph">
                                ©
                                <span><script>document.write(new Date().getFullYear())</script></span> <img src="/img/company/grapecity_150.png" alt="GrapeCity">, inc. All Rights Reserved. All product and company names herein may be trademarks of their respective owners.
                            </p>

                        </div>
                    </div>
                    <div class="footer-column footer-column-menu">
                        <div class="padder clearfix">
                            <h3>Company</h3>
                            <ul class="footer-menu clearfix">
                                <li><a href="/about-us/">About Us</a></li>
                                <li><a href="/contact-us/">Contact Us</a></li>
                                <li><a href="/legal/">Legal Information</a></li>
                                <li><a href="/privacy/">Privacy Policy</a></li>
                                <li><a href="/terms/">Terms of Use</a></li>
                            </ul>

                        </div>

                    </div>


                </div>
            </footer>
        </article>
    </main>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="/js/dist/jquery.unslider-dist.js"></script>
    <script src="/js/dist/jquery.matchHeight-dist.js"></script>
    <script src="/js/dist/jquery.waypoints-dist.js"></script>
    <script src="/js/dist/jquery.nicescroll-dist.js"></script>
    <script src="/js/dist/jquery.velocity-dist.js"></script>
    <script src="/js/dist/jquery.event.move-dist.js"></script>
    <script src="/js/dist/jquery.event.swipe-dist.js"></script>
    <script src="/js/dist/init-dist.js"></script>



</body>

</html> 