<hr>
<p>title: SpreadASP Excel Copy/Paste
layout: post
template: post.hbt
permalink: /2015/10/05/spreadasp-excel-copypaste/
dzsvg_fullscreen:</p>
<ul>
<li>none
dzsvg_extras_featured:</li>
<li>none
categories:</li>
<li>ASP.NET</li>
<li>Spread</li>
<li>Spreadsheets</li>
<li>Tutorials</li>
</ul>
<hr>
<p>Spread for ASP.NET is a useful component for providing Spreadsheet functionality on a web server. While Spread has many great features, it might be beneficial for a user to paste cell ranges into the Spread component, without having to worry about reformatting the cells or writing any code. In this tutorial, we will create an ASP Web Application that allows the users to paste cell ranges from Excel into Spread while keeping the formatting.</p>
<p>Download this project:� <a href="http://sphelp.grapecity.com/wp-content/uploads/2015/10/ExcelSpreadCopyPaste.zip">ExcelSpreadCopyPaste</a></p>
<p>To start off, we must create an ASP Web Application and add a Spread component to a web page. For more information about adding a Spread component, see the tutorial here: <a href="http://sphelp.grapecity.com/WebHelp/SpreadNet8/ASP2/webframe.html#spweb-startvs2013.html">http://sphelp.grapecity.com/WebHelp/SpreadNet8/ASP2/webframe.html#spweb-startvs2013.html</a></p>
<h3 id="set-up-the-page">Set Up the Page</h3>
<p>Once the default page has been set and a Spread component has been added to it, specify a “ContentEditable” div above the Spread component like the code below:</p>
<pre><code><span class="hljs-subst">&amp;</span><span class="hljs-literal">lt</span>;p<span class="hljs-subst">&amp;</span><span class="hljs-literal">gt</span>;You can copy cells from an Excel file <span class="hljs-literal">and</span> put them <span class="hljs-keyword">into</span> the Spreadsheet below<span class="hljs-subst">!&amp;</span><span class="hljs-literal">lt</span>;/p<span class="hljs-subst">&amp;</span><span class="hljs-literal">gt</span>;
<span class="hljs-subst">&amp;</span><span class="hljs-literal">lt</span>;div class<span class="hljs-subst">=</span><span class="hljs-string">"toggle"</span> id<span class="hljs-subst">=</span><span class="hljs-string">"contentEditor"</span> contenteditable style<span class="hljs-subst">=</span><span class="hljs-string">"background: #ffffff"</span><span class="hljs-subst">&amp;</span><span class="hljs-literal">gt</span>;
    <span class="hljs-subst">&amp;</span><span class="hljs-literal">lt</span>;p<span class="hljs-subst">&amp;</span><span class="hljs-literal">gt</span>;Paste cells here<span class="hljs-subst">!&amp;</span><span class="hljs-literal">lt</span>;/p<span class="hljs-subst">&amp;</span><span class="hljs-literal">gt</span>;
<span class="hljs-subst">&amp;</span><span class="hljs-literal">lt</span>;/div<span class="hljs-subst">&amp;</span><span class="hljs-literal">gt</span>;
<span class="hljs-subst">&amp;</span><span class="hljs-literal">lt</span>;FarPoint:FpSpread ID<span class="hljs-subst">=</span><span class="hljs-string">"FpSpread1"</span> runat<span class="hljs-subst">=</span><span class="hljs-string">"server"</span> BorderColor<span class="hljs-subst">=</span><span class="hljs-string">"#A0A0A0"</span> BorderStyle<span class="hljs-subst">=</span><span class="hljs-string">"Solid"</span> BorderWidth<span class="hljs-subst">=</span><span class="hljs-string">"1px"</span> Height<span class="hljs-subst">=</span><span class="hljs-string">"400px"</span> Width<span class="hljs-subst">=</span><span class="hljs-string">"1000px"</span><span class="hljs-subst">&amp;</span><span class="hljs-literal">gt</span>;
    <span class="hljs-subst">&amp;</span><span class="hljs-literal">lt</span>;commandbar backcolor<span class="hljs-subst">=</span><span class="hljs-string">"#F6F6F6"</span> buttonfacecolor<span class="hljs-subst">=</span><span class="hljs-string">"Control"</span> buttonhighlightcolor<span class="hljs-subst">=</span><span class="hljs-string">"ControlLightLight"</span> buttonshadowcolor<span class="hljs-subst">=</span><span class="hljs-string">"ControlDark"</span><span class="hljs-subst">&amp;</span><span class="hljs-literal">gt</span>;
    <span class="hljs-subst">&amp;</span><span class="hljs-literal">lt</span>;/commandbar<span class="hljs-subst">&amp;</span><span class="hljs-literal">gt</span>;
    <span class="hljs-subst">&amp;</span><span class="hljs-literal">lt</span>;sheets<span class="hljs-subst">&amp;</span><span class="hljs-literal">gt</span>;
        <span class="hljs-subst">&amp;</span><span class="hljs-literal">lt</span>;FarPoint:SheetView SheetName<span class="hljs-subst">=</span><span class="hljs-string">"Sheet1"</span><span class="hljs-subst">&amp;</span><span class="hljs-literal">gt</span>;
        <span class="hljs-subst">&amp;</span><span class="hljs-literal">lt</span>;/FarPoint:SheetView<span class="hljs-subst">&amp;</span><span class="hljs-literal">gt</span>;
    <span class="hljs-subst">&amp;</span><span class="hljs-literal">lt</span>;/sheets<span class="hljs-subst">&amp;</span><span class="hljs-literal">gt</span>;
<span class="hljs-subst">&amp;</span><span class="hljs-literal">lt</span>;/FarPoint:FpSpread<span class="hljs-subst">&amp;</span><span class="hljs-literal">gt</span>;</code></pre>

<p>The web page should now look like the following screen shot:<figure id="attachment_665061" style="width: 645px" class="wp-caption aligncenter"></p>
<p><a href="http://sphelp.grapecity.com/wp-content/uploads/2015/10/Figure1.png"><img class=" wp-image-665061  " alt="The default page with content editable div and Spread on it." src="http://sphelp.grapecity.com/wp-content/uploads/2015/10/Figure1-1024x699.png" width="645" height="440" /></a><figcaption class="wp-caption-text">The default page with content editable div and Spread on it.</figcaption></figure> </p>
<p>### </p>
<h3 id="add-spread-code">Add Spread Code</h3>
<p>Add a script to the web page for the client-side code, and define the “window.onload” function:</p>
<pre><code class="”language-csharp”">&lt;script lang=”javascript” type=”text/javascript”&gt;

window.onload = function () {

}

&lt;/script&gt;

<pre><code class="hljs">The <span class="hljs-property">rest</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> code <span class="hljs-keyword">for</span> this tutorial will be inside <span class="hljs-keyword">of</span> this function. Define <span class="hljs-keyword">the</span> Spread component <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> <span class="hljs-keyword">script</span> <span class="hljs-keyword">by</span> getting <span class="hljs-keyword">the</span> element <span class="hljs-function_start"><span class="hljs-keyword">on</span></span> <span class="hljs-keyword">the</span> page:

&lt;pre&gt;&lt;code <span class="hljs-type">class</span>=<span class="hljs-string">"”language-javascript”"</span>&gt;var spread = document.getElementById(<span class="hljs-string">"&amp;lt;%=FpSpread1.ClientID %&amp;gt;"</span>);</code></pre>

<p>The “ContentEditable” div is where the Excel cell ranges are going to be pasted, so define the function for the “onPaste” event:</p>
<pre><code class="”language-javascript”">$('[contenteditable]').on('paste', function (e) {}):<pre><code class="hljs">The <span class="hljs-property">rest</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> code <span class="hljs-keyword">for</span> this tutorial will be defined within <span class="hljs-keyword">the</span> function specified <span class="hljs-keyword">above</span>. To <span class="hljs-keyword">get</span> <span class="hljs-command">the clipboard</span> data <span class="hljs-keyword">to</span> paste <span class="hljs-keyword">into</span> Spread, define a “<span class="hljs-type">text</span>” variable:

&lt;pre&gt;&lt;code <span class="hljs-type">class</span>=<span class="hljs-string">"”language-javascript”"</span>&gt;var <span class="hljs-type">text</span> = (e.originalEvent || e).clipboardData.getData('<span class="hljs-type">text</span>/html');</code></pre>

<p>A new div element will be created on the page to help with merging the data into spread:</p>
<pre><code class="”language-javascript”">var newDiv = document.createElement("div");
newDiv.innerHTML = text;
newDiv.id = "spreadTable";
document.getElementById("contentEditor").appendChild(newDiv);<pre><code class="hljs">Define a <span class="hljs-keyword">function</span> called “addToSpread” that will handle adding the content <span class="hljs-keyword">from</span> that <span class="hljs-keyword">new</span> div <span class="hljs-keyword">to</span> the Spread component <span class="hljs-keyword">with</span> the correct formatting. <span class="hljs-keyword">For</span> simplicity, define a variable called “table” <span class="hljs-keyword">in</span> this <span class="hljs-keyword">function</span> <span class="hljs-keyword">to</span> refer <span class="hljs-keyword">to</span> the table containing the data <span class="hljs-keyword">and</span> formatting <span class="hljs-keyword">from</span> Excel:

&lt;pre&gt;&lt;code <span class="hljs-keyword">class</span>=<span class="hljs-string">"”language-javascript”"</span>&gt;var table = document.getElementById(<span class="hljs-comment">'spreadTable').getElementsByTagName('table')[0];</span></code></pre>

<p>Go through the table to get the values and properties to set in Spread using For loops:</p>
<pre><code class="”language-javascript”">for (var i = 0, row; row = table.rows[i]; i++) {
    for (var j = 0, cell; cell = row.cells[j]; j++) {}
}<pre><code class="hljs">Within the inner For loop, <span class="hljs-operator"><span class="hljs-keyword">set</span> the <span class="hljs-keyword">value</span> <span class="hljs-keyword">of</span> the cells <span class="hljs-keyword">in</span> Spread <span class="hljs-keyword">to</span> the <span class="hljs-keyword">table</span> <span class="hljs-keyword">values</span>:

&lt;pre&gt;&lt;code class=<span class="hljs-string">"”language-javascript”"</span>&gt;spread.SetValue(I, j, cell.textContent);</span></code></pre>

<p>Set the column width to match the table:</p>
<pre><code class="”language-javascript”">if (cell.width &gt; 0) {
    spread.setColWidth(j, cell.width);
}<pre><code class="hljs">Get <span class="hljs-keyword">the</span> rules <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> css <span class="hljs-keyword">in</span> order <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> <span class="hljs-keyword">the</span> background <span class="hljs-keyword">and</span> foreground colors <span class="hljs-keyword">of</span> cells <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> table <span class="hljs-keyword">and</span> apply them <span class="hljs-keyword">to</span> <span class="hljs-keyword">the</span> Spread component:

&lt;pre&gt;&lt;code <span class="hljs-type">class</span>=<span class="hljs-string">"”language-csharp”"</span>&gt;var rules = document.styleSheets.<span class="hljs-property">item</span>(<span class="hljs-number">4</span>);
rules = rules.cssRules || rules.rules;
<span class="hljs-keyword">for</span> (var k = <span class="hljs-number">0</span>; k &amp;lt; rules.<span class="hljs-property">length</span>; k++) {
    <span class="hljs-keyword">if</span> (rules.<span class="hljs-property">item</span>(k).selectorText == <span class="hljs-string">"."</span> + cell.className) {
        var currentCell = spread.Cells(i, j);
        currentCell.SetBackColor(rules.<span class="hljs-property">item</span>(k).style.backgroundColor);
        currentCell.SetForeColor(rules.<span class="hljs-property">item</span>(k).style.color);
        break;
    }
}</code></pre>

<p>Set the height of the rows for both the rows and row headers:</p>
<pre><code class="”language-csharp”">if (cell.height &gt; 0) {
    var spreadRowHeader = document.getElementById('MainContent_FpSpread1_rh');
    if (spreadRowHeader.rows[i].style.height != null) {
        spreadRowHeader.rows[i].style.height = cell.height + 'px';
    }
    var spreadTable = document.getElementById('MainContent_FpSpread1_viewport');
    if (spreadTable.rows[i].style.height != null) {
        spreadTable.rows[i].style.height = cell.height + 'px';
    }
}<pre><code class="hljs">Outside <span class="hljs-keyword">of</span> the <span class="hljs-keyword">For</span> loops, <span class="hljs-keyword">set</span> the range selected <span class="hljs-keyword">in</span> the Spread component <span class="hljs-keyword">to</span> the cells just pasted <span class="hljs-keyword">in</span>:

&lt;pre&gt;&lt;code <span class="hljs-keyword">class</span>=<span class="hljs-string">"”language-csharp”"</span>&gt;spread.SetSelectedRange(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, i, j);</code></pre>

<p>A user should be able to copy cells from an Excel file and paste them into the “ContentEditable” div on the page. Once they do so, the cells will be copied into the Spread component with some formatting applied to them. This is just one example of how Spread can provide an easy way for users to interact with Spread with no coding knowledge required.<figure id="attachment_665062" style="width: 614px" class="wp-caption aligncenter"></p>
<p><a href="http://sphelp.grapecity.com/wp-content/uploads/2015/10/Figure2.png"><img class=" wp-image-665062 " alt="The Excel file that was copied from." src="http://sphelp.grapecity.com/wp-content/uploads/2015/10/Figure2-1024x528.png" width="614" height="317" /></a><figcaption class="wp-caption-text">The Excel file that was copied from.</figcaption></figure> <figure id="attachment_665063" style="width: 614px" class="wp-caption aligncenter"><a href="http://sphelp.grapecity.com/wp-content/uploads/2015/10/Figure3.png"><img class="wp-image-665063 " alt="The Spread page with the copied Excel cell range pasted into it." src="http://sphelp.grapecity.com/wp-content/uploads/2015/10/Figure3-1024x666.png" width="614" height="400" /></a><figcaption class="wp-caption-text">The Spread page with the copied Excel cell range pasted into it.</figcaption></figure> </p>
<p>&nbsp;</p>
