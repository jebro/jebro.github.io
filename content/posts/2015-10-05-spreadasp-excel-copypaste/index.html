<hr>
<p>title: SpreadASP Excel Copy/Paste
layout: post
template: post.hbt
permalink: /2015/10/05/spreadasp-excel-copypaste/
dzsvg_fullscreen:</p>
<ul>
<li>none
dzsvg_extras_featured:</li>
<li>none
categories:</li>
<li>ASP.NET</li>
<li>Spread</li>
<li>Spreadsheets</li>
<li>Tutorials</li>
</ul>
<hr>
<p>Spread for ASP.NET is a useful component for providing Spreadsheet functionality on a web server. While Spread has many great features, it might be beneficial for a user to paste cell ranges into the Spread component, without having to worry about reformatting the cells or writing any code. In this tutorial, we will create an ASP Web Application that allows the users to paste cell ranges from Excel into Spread while keeping the formatting.</p>
<p>Download this project:� <a href="http://sphelp.grapecity.com/wp-content/uploads/2015/10/ExcelSpreadCopyPaste.zip">ExcelSpreadCopyPaste</a></p>
<p>To start off, we must create an ASP Web Application and add a Spread component to a web page. For more information about adding a Spread component, see the tutorial here: <a href="http://sphelp.grapecity.com/WebHelp/SpreadNet8/ASP2/webframe.html#spweb-startvs2013.html">http://sphelp.grapecity.com/WebHelp/SpreadNet8/ASP2/webframe.html#spweb-startvs2013.html</a></p>
<h3 id="set-up-the-page">Set Up the Page</h3>
<p>Once the default page has been set and a Spread component has been added to it, specify a “ContentEditable” div above the Spread component like the code below:</p>
<pre><code class="language-csharp">&lt;h1&gt;Excel-Spread Copy-Paste&lt;/h1&gt;
&lt;p&gt;You can copy cells from an Excel file and put them into the Spreadsheet below!&lt;/p&gt;
&lt;div class="toggle" id="contentEditor" contenteditable style="background: #ffffff"&gt;
    &lt;p&gt;Paste cells here!&lt;/p&gt;
&lt;/div&gt;
&lt;FarPoint:FpSpread ID="FpSpread1" runat="server" BorderColor="#A0A0A0" BorderStyle="Solid" BorderWidth="1px" Height="400px" Width="1000px"&gt;
    &lt;commandbar backcolor="#F6F6F6" buttonfacecolor="Control" buttonhighlightcolor="ControlLightLight" buttonshadowcolor="ControlDark"&gt;
    &lt;/commandbar&gt;
    &lt;sheets&gt;
        &lt;FarPoint:SheetView SheetName="Sheet1"&gt;
        &lt;/FarPoint:SheetView&gt;
    &lt;/sheets&gt;
&lt;/FarPoint:FpSpread&gt;
</code></pre>

<p>The web page should now look like the following screen shot:<figure id="attachment_665061" style="width: 645px" class="wp-caption aligncenter"></p>
<p><a href="http://sphelp.grapecity.com/wp-content/uploads/2015/10/Figure1.png"><img class=" wp-image-665061  " alt="The default page with content editable div and Spread on it." src="http://sphelp.grapecity.com/wp-content/uploads/2015/10/Figure1-1024x699.png" width="645" height="440" /></a><figcaption class="wp-caption-text">The default page with content editable div and Spread on it.</figcaption></figure> </p>
<p>### </p>
<h3 id="add-spread-code">Add Spread Code</h3>
<p>Add a script to the web page for the client-side code, and define the “window.onload” function:</p>
<pre><code class="”language-csharp”">&lt;script lang=”javascript” type=”text/javascript”&gt;

window.onload = function () {

}

&lt;/script&gt;

</code></pre>

<p>The rest of the code for this tutorial will be inside of this function. Define the Spread component in the script by getting the element on the page:</p>
<pre><code class="”language-javascript”">var spread = document.getElementById("&lt;%=FpSpread1.ClientID %&gt;");</code></pre>

<p>The “ContentEditable” div is where the Excel cell ranges are going to be pasted, so define the function for the “onPaste” event:</p>
<pre><code class="”language-javascript”">$('[contenteditable]').on('paste', function (e) {}):</code></pre>

<p>The rest of the code for this tutorial will be defined within the function specified above. To get the clipboard data to paste into Spread, define a “text” variable:</p>
<pre><code class="”language-javascript”">var text = (e.originalEvent || e).clipboardData.getData('text/html');</code></pre>

<p>A new div element will be created on the page to help with merging the data into spread:</p>
<pre><code class="”language-javascript”">var newDiv = document.createElement("div");
newDiv.innerHTML = text;
newDiv.id = "spreadTable";
document.getElementById("contentEditor").appendChild(newDiv);</code></pre>

<p>Define a function called “addToSpread” that will handle adding the content from that new div to the Spread component with the correct formatting. For simplicity, define a variable called “table” in this function to refer to the table containing the data and formatting from Excel:</p>
<pre><code class="”language-javascript”">var table = document.getElementById('spreadTable').getElementsByTagName('table')[0];</code></pre>

<p>Go through the table to get the values and properties to set in Spread using For loops:</p>
<pre><code class="”language-javascript”">for (var i = 0, row; row = table.rows[i]; i++) {
    for (var j = 0, cell; cell = row.cells[j]; j++) {}
}</code></pre>

<p>Within the inner For loop, set the value of the cells in Spread to the table values:</p>
<pre><code class="”language-javascript”">spread.SetValue(I, j, cell.textContent);</code></pre>

<p>Set the column width to match the table:</p>
<pre><code class="”language-javascript”">if (cell.width &gt; 0) {
    spread.setColWidth(j, cell.width);
}</code></pre>

<p>Get the rules of the css in order to get the background and foreground colors of cells in the table and apply them to the Spread component:</p>
<pre><code class="”language-csharp”">var rules = document.styleSheets.item(4);
rules = rules.cssRules || rules.rules;
for (var k = 0; k &lt; rules.length; k++) {
    if (rules.item(k).selectorText == "." + cell.className) {
        var currentCell = spread.Cells(i, j);
        currentCell.SetBackColor(rules.item(k).style.backgroundColor);
        currentCell.SetForeColor(rules.item(k).style.color);
        break;
    }
}</code></pre>

<p>Set the height of the rows for both the rows and row headers:</p>
<pre><code class="”language-csharp”">if (cell.height &gt; 0) {
    var spreadRowHeader = document.getElementById('MainContent_FpSpread1_rh');
    if (spreadRowHeader.rows[i].style.height != null) {
        spreadRowHeader.rows[i].style.height = cell.height + 'px';
    }
    var spreadTable = document.getElementById('MainContent_FpSpread1_viewport');
    if (spreadTable.rows[i].style.height != null) {
        spreadTable.rows[i].style.height = cell.height + 'px';
    }
}</code></pre>

<p>Outside of the For loops, set the range selected in the Spread component to the cells just pasted in:</p>
<pre><code class="”language-csharp”">spread.SetSelectedRange(0, 0, i, j);</code></pre>

<p>Then call the function just defined and hide the div element used to paste cells:</p>
<pre><code class="”language-csharp”">addToSpread();
var removeDiv = document.getElementById('contentEditor');
if (removeDiv) {
    removeDiv.hidden = true;
}</code></pre>

<p>A user should be able to copy cells from an Excel file and paste them into the “ContentEditable” div on the page. Once they do so, the cells will be copied into the Spread component with some formatting applied to them. This is just one example of how Spread can provide an easy way for users to interact with Spread with no coding knowledge required.<figure id="attachment_665062" style="width: 614px" class="wp-caption aligncenter"></p>
<p><a href="http://sphelp.grapecity.com/wp-content/uploads/2015/10/Figure2.png"><img class=" wp-image-665062 " alt="The Excel file that was copied from." src="http://sphelp.grapecity.com/wp-content/uploads/2015/10/Figure2-1024x528.png" width="614" height="317" /></a><figcaption class="wp-caption-text">The Excel file that was copied from.</figcaption></figure> <figure id="attachment_665063" style="width: 614px" class="wp-caption aligncenter"><a href="http://sphelp.grapecity.com/wp-content/uploads/2015/10/Figure3.png"><img class="wp-image-665063 " alt="The Spread page with the copied Excel cell range pasted into it." src="http://sphelp.grapecity.com/wp-content/uploads/2015/10/Figure3-1024x666.png" width="614" height="400" /></a><figcaption class="wp-caption-text">The Spread page with the copied Excel cell range pasted into it.</figcaption></figure> </p>
<p>&nbsp;</p>
